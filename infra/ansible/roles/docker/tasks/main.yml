---
- name: Install Docker on Amazon Linux
  become: true
  yum:
    name: docker
    state: present

- name: Enable and start Docker
  become: true
  service:
    name: docker
    enabled: yes
    state: started

- name: Add ec2-user to docker group
  become: true
  user:
    name: ec2-user
    groups: docker
    append: yes

# Optional but recommended: install docker compose v2 plugin if available
- name: Install docker-compose (Amazon Linux extras, if available)
  become: true
  shell: |
    set -e
    if command -v amazon-linux-extras >/dev/null 2>&1; then
      amazon-linux-extras install -y docker
    fi
  args:
    warn: false
  changed_when: false
  failed_when: false

- name: Verify Docker works
  become: true
  command: docker --version
  register: docker_ver

- debug:
    var: docker_ver.stdout
